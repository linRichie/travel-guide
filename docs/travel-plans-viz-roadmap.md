# 旅行规划可视化展示页面 - 任务清单

## 项目概述

创建一个旅行规划可视化展示页面，用于展示所有保存的旅行计划，采用卡片式布局，支持排序和快速加载功能。

## 整合方案（方案 A - 已实施）

将「旅行规划库」和「旅行统计」整合为统一的「旅行中心」页面，使用标签页切换：

```
┌─────────────────────────────────────────────────────┐
│  旅行中心                                            │
├─────────────────────────────────────────────────────┤
│  [ 我的计划 ]  [ 统计图表 ]  [ 旅行足迹 ]            │
├─────────────────────────────────────────────────────┤
│                                                       │
│  我的计划：卡片列表 + 搜索/筛选/排序                   │
│  统计图表：目的地分布、月份分布、预算统计               │
│  旅行足迹：世界地图、年度记录、洲分布、照片趋势         │
│                                                       │
└─────────────────────────────────────────────────────┘
```

### 整合后文件结构

```tree
src/app/diary/
├── pages/
│   ├── TravelCenter.jsx        # 旅行中心（整合页面）
│   └── Planner.jsx             # 旅行规划器
├── components/
│   ├── PlanCard.jsx            # 计划卡片
│   ├── PlanCharts.jsx          # 统计图表组件
│   └── WorldMap.jsx            # 世界地图组件
└── utils/
    └── storage.js              # 数据存储
```

**已删除文件**:
- `TravelPlans.jsx` - 已整合到 TravelCenter
- `Stats.jsx` - 已整合到 TravelCenter

### 路由变更

| 旧路由 | 新路由 | 说明 |
|--------|--------|------|
| `/diary/plans` → `TravelPlans` | `/diary/plans` → `TravelCenter` | 整合页面 |
| `/diary/stats` → `Stats` | `/diary/stats` → 重定向到 `/diary/plans` | 已整合 |

### 导航菜单变更

- 移除「旅行统计」独立导航项
- 「旅行规划库」更名为「旅行中心」

## 设计规范

### 颜色方案

```javascript
{
  // 主色（紫色系）
  primary: 'purple-500',     // 主操作按钮、高亮
  primaryLight: 'purple-400', // 悬停状态
  primaryDark: 'purple-600',  // 按下状态

  // 背景色（暗色主题）
  bgMain: 'black',           // 主背景
  bgSecondary: 'gray-900',   // 次级背景
  bgCard: 'white/5',         // 卡片背景（毛玻璃）
  bgCardHover: 'white/10',   // 卡片悬停

  // 文字色
  textMain: 'white',         // 主要文字
  textMuted: 'gray-400',     // 次要文字
  textFaint: 'gray-500'      // 辅助文字
}
```

### 组件样式

```javascript
// 卡片样式
card: {
  base: 'backdrop-blur-lg bg-white/5 border border-white/10 rounded-2xl',
  hover: 'hover:bg-white/10 hover:border-purple-500/30 transition-all duration-300',
  shadow: 'shadow-lg shadow-purple-500/10'
}

// 按钮样式
button: {
  primary: 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl font-medium hover:opacity-90 transition-opacity',
  secondary: 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white rounded-xl font-medium transition-all'
}
```

---

## 开发任务清单

### 阶段一：基础结构搭建 ✅

- [x] **1.1 创建页面组件**
  - 文件：`src/app/diary/pages/TravelPlans.jsx`
  - 功能：旅行规划列表主页面
  - 状态：plans（计划列表）, loading（加载状态）, sortBy（排序方式）, filterBy（筛选条件）

- [x] **1.2 创建卡片组件**
  - 文件：`src/app/diary/components/PlanCard.jsx`
  - 功能：单个旅行计划卡片
  - 显示：目的地、日期、天数、预算、操作按钮

- [x] **1.3 更新路由配置**
  - 文件：`src/App.jsx`
  - 添加路由：`/diary/plans` → `TravelPlans`

### 阶段二：数据获取与状态管理 ✅

- [x] **2.1 实现数据加载**
  - 从 SQLite 数据库加载所有旅行计划
  - 使用 `getTravelPlans()` 函数
  - 添加加载状态和错误处理

- [x] **2.2 实现排序功能**
  - 按目的地名称排序
  - 按出发日期排序
  - 按旅行天数排序
  - 按创建时间排序

- [x] **2.3 实现筛选功能**
  - 按目的地筛选
  - 按预算级别筛选
  - 按天数范围筛选

### 阶段三：UI 组件实现 ✅

- [x] **3.1 顶部工具栏**
  - 标题：`旅行规划库`
  - 统计信息：全部计划、即将出发、总天数
  - 新建按钮：跳转到 `/diary/planner`
  - 排序/筛选下拉菜单

- [x] **3.2 卡片网格布局**
  - 响应式网格：`grid-cols-1 md:grid-cols-2 lg:grid-cols-3`
  - 卡片间距：`gap-6`
  - 空状态提示：无计划时显示

- [x] **3.3 计划卡片设计**

  ```text
  ┌─────────────────────────────────┐
  │ 📍 成都         [编辑] [删除]    │
  │ ─────────────────────────────── │
  │ 📅 2025-06-01     🕐 5天        │
  │ 💰 舒适型        ⭐ 收藏         │
  │ ─────────────────────────────── │
  │ [编辑计划]                     │
  └─────────────────────────────────┘
  ```

- [x] **3.4 快速操作按钮**
  - 加载计划：将计划数据填入表单
  - 编辑模式：跳转到规划页面
  - 删除确认：弹窗确认后删除

### 阶段四：交互优化 ✅

- [x] **4.1 悬停效果**
  - 卡片悬停：轻微放大、边框高亮
  - 按钮悬停：颜色变化、阴影增强

- [x] **4.2 动画效果**
  - 页面加载：淡入动画
  - 卡片出现：交错淡入
  - 删除操作：收缩淡出

- [x] **4.3 响应式适配**
  - 移动端：单列布局
  - 平板：双列布局
  - 桌面：三列布局

### 阶段五：高级功能（可选）

- [x] **5.1 搜索功能**
  - 按目的地名称搜索
  - 实时搜索建议

- [x] **5.2 统计图表**
  - 目的地分布图（横向柱状图）
  - 月份分布图（柱状图）
  - 预算占比图（饼图）
  - 旅行天数分布图（柱状图）
  - 统计摘要卡片

- [ ] **5.3 导出功能**
  - 导出为 JSON
  - 导出为 PDF

---

## 文件结构

```tree
src/app/diary/
├── pages/
│   └── TravelPlans.jsx          # 主页面
├── components/
│   ├── PlanCard.jsx             # 计划卡片
│   ├── PlanCharts.jsx           # 统计图表组件（新增）
│   └── PlanFilters.jsx          # 筛选功能已集成到主页面
└── utils/
    └── storage.js               # 已有，无需修改
```

---

## 数据流

```
┌─────────────────────────────────────────────────────────┐
│                    TravelPlans 页面                      │
├─────────────────────────────────────────────────────────┤
│  useEffect → getTravelPlans() → setPlans()              │
│                                                          │
│  plans → filter() → sort() → filteredPlans              │
│                                                          │
│  filteredPlans → map() → <PlanCard />                   │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                     PlanCard 组件                        │
├─────────────────────────────────────────────────────────┤
│  显示：destination, startDate, days, budget             │
│  操作：onLoad, onEdit, onDelete                          │
└─────────────────────────────────────────────────────────┘
```

---

## 实施顺序

1. **第一步**：创建 `PlanCard.jsx` 组件
2. **第二步**：创建 `TravelPlans.jsx` 主页面
3. **第三步**：添加路由配置
4. **第四步**：实现排序和筛选功能
5. **第五步**：优化动画和交互效果
6. **第六步**：测试响应式布局

---

## 验收标准

- [x] 页面能正确加载所有保存的旅行计划
- [x] 卡片显示完整信息（目的地、日期、天数、预算）
- [x] 支持按多种方式排序
- [x] 点击"加载计划"能正确跳转到规划页面
- [x] 删除功能正常工作
- [x] 暗色主题样式与现有页面一致
- [x] 响应式布局在移动端正常显示

---

## 完成总结

**完成日期**: 2025-01-15

**完成进度**: 100%（方案 A 整合完成）

### 整合功能（方案 A）

将「旅行规划库」和「旅行统计」整合为统一的「旅行中心」页面：

#### 标签页一：我的计划
- 卡片式计划列表展示
- 搜索功能（目的地、日期）
- 筛选功能（目的地、预算）
- 排序功能（创建时间、出发日期、天数、目的地）
- 统计摘要卡片（全部计划、即将出发、总天数）

#### 标签页二：统计图表
- 目的地分布图（横向柱状图）
- 月份分布图（柱状图）
- 预算占比图（饼图）
- 旅行天数分布图（柱状图）

#### 标签页三：旅行足迹
- 世界地图标记
- 年度旅行记录柱状图
- 洲分布统计
- 照片数量趋势图
- 已访问城市列表

### 新增/修改文件

| 文件 | 操作 | 说明 |
|------|------|------|
| `src/app/diary/pages/TravelCenter.jsx` | 新增 | 整合页面（800+行） |
| `src/App.jsx` | 修改 | 路由配置更新 |
| `src/app/diary/DiaryLayout.jsx` | 修改 | 导航菜单更新 |
| `src/app/diary/components/PlanCharts.jsx` | 保留 | 统计图表组件 |

### 待实现功能（可选）

- [x] **5.3 导出功能（JSON、PDF）** - 待实现

---

## Bug 修复记录（2025-01-15）

### 旅行足迹页面问题修复

#### 1. 照片数量趋势图（直方图+折线图组合）
**问题**: 原组件只有直方图，用户期望看到直方图与折线图的组合展示
**修复**:
- 在 `PhotoTrendChart.jsx` 中添加 SVG 折线图叠加层
- 实现面积图渐变填充效果
- 折线图数据点带有悬停放大效果
- 底部图例增加"趋势线"说明

#### 2. 洲分布统计样式不统一
**问题**: 洲分布卡片样式与其他组件不一致
**修复**:
- 统一使用 `bg-gray-900/30 border-white/5` 样式
- 添加进度条可视化效果
- 统一卡片内边距和圆角样式
- 所有图标替换为内联 SVG

#### 3. 年度旅行记录高度局促
**问题**: 柱状图触及容器顶部，视觉上过于拥挤
**修复**:
- 容器高度从 `h-40` 增加到 `h-48`
- 柱子高度计算改为百分比制，确保不会超出容器
- 顶部预留更多空间显示数值标签

#### 4. 世界地图替换为高德地图
**问题**: 原 SVG 世界地图功能不可用
**修复**:
- 创建 `AMapFootprint.jsx` 组件
- 使用高德地图 JavaScript API (`@amap/amap-jsapi-loader`)
- 实现已访问国家标记点
- 添加国家间旅行路线连线
- 支持暗色主题地图样式
